{% extends 'blog/base.html' %}
{% load static %}

{% block title %}Search Results - Django Blog{% endblock %}

{% block content %}
<div class="posts-container">
    <div class="posts-header">
        <h1><i class="fas fa-search"></i> Search Results</h1>
        <p class="subtitle">
            {% if query %}
                Searching for "{{ query }}"
            {% else %}
                Search our blog
            {% endif %}
        </p>
        
        <!-- Search Form -->
        <div class="search-form-container">
            <form method="GET" action="{% url 'search-posts' %}" class="search-form">
                <div class="input-group">
                    <input type="text" name="query" class="form-control" 
                           placeholder="Search posts..." value="{{ query }}">
                    <button type="submit" class="btn btn-search">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="posts-content">
        <div class="posts-sidebar">
            <!-- Filter Options -->
            <div class="filter-card">
                <h3><i class="fas fa-filter"></i> Filter Results</h3>
                <form method="GET" action="{% url 'search-posts' %}">
                    <input type="hidden" name="query" value="{{ query }}">
                    <div class="form-group">
                        <label>Category:</label>
                        {{ form.category }}
                    </div>
                    <div class="form-group">
                        <label>Tag:</label>
                        {{ form.tag }}
                    </div>
                    <div class="form-group">
                        <label>Author:</label>
                        {{ form.author }}
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                </form>
            </div>
            
            <!-- Popular Tags -->
            {% if popular_tags %}
                <div class="tags-card">
                    <h3><i class="fas fa-tags"></i> Popular Tags</h3>
                    <div class="tags-list">
                        {% for tag in popular_tags %}
                            <a href="{% url 'tag-posts' tag.slug %}" class="tag">
                                {{ tag.name }}
                                <span class="tag-count">{{ tag.post_count }}</span>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
        
        <div class="posts-main">
            {% if posts %}
                <div class="results-info">
                    <p>Found {{ total_results }} result{{ total_results|pluralize }}</p>
                </div>
                
                <div class="posts-grid">
                    {% for post in posts %}
                        <div class="post-card">
                            {% if post.featured_image %}
                                <div class="post-image">
                                    <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
                                </div>
                            {% endif %}
                            
                            <div class="post-content">
                                <div class="post-meta">
                                    <div class="author-info">
                                        {% if post.author.profile.profile_picture %}
                                            <img src="{{ post.author.profile.profile_picture.url }}" 
                                                 alt="{{ post.author.username }}" 
                                                 class="author-avatar">
                                        {% else %}
                                            <div class="author-avatar-default">
                                                <i class="fas fa-user"></i>
                                            </div>
                                        {% endif %}
                                        <div class="author-details">
                                            <span class="author-name">{{ post.author.username }}</span>
                                            <span class="post-date">{{ post.published_date|date:"M d, Y" }}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <h3 class="post-title">
                                    <a href="{% url 'post-detail' post.slug %}">{{ post.title }}</a>
                                </h3>
                                
                                <p class="post-excerpt">{{ post.excerpt|truncatewords:30 }}</p>
                                
                                <!-- Tags -->
                                {% if post.tags.all %}
                                    <div class="post-tags">
                                        {% for tag in post.tags.all|slice:":3" %}
                                            <a href="{% url 'tag-posts' tag.slug %}" class="tag-badge">
                                                {{ tag.name }}
                                            </a>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                
                                <div class="post-footer">
                                    <a href="{% url 'post-detail' post.slug %}" class="btn btn-read">
                                        Read More
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if posts.has_other_pages %}
                    <nav class="pagination">
                        <ul class="pagination-list">
                            {% if posts.has_previous %}
                                <li class="page-item">
                                    <a href="?query={{ query }}&page=1" class="page-link">
                                        First
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a href="?query={{ query }}&page={{ posts.previous_page_number }}" class="page-link">
                                        Previous
                                    </a>
                                </li>
                            {% endif %}
                            
                            {% for num in posts.paginator.page_range %}
                                {% if posts.number == num %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ num }}</span>
                                    </li>
                                {% elif num > posts.number|add:'-3' and num < posts.number|add:'3' %}
                                    <li class="page-item">
                                        <a href="?query={{ query }}&page={{ num }}" class="page-link">{{ num }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if posts.has_next %}
                                <li class="page-item">
                                    <a href="?query={{ query }}&page={{ posts.next_page_number }}" class="page-link">
                                        Next
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a href="?query={{ query }}&page={{ posts.paginator.num_pages }}" class="page-link">
                                        Last
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-search fa-3x"></i>
                    <h3>No posts found</h3>
                    <p>Try different search terms or filters.</p>
                    <a href="{% url 'post-list' %}" class="btn btn-primary">
                        Browse All Posts
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.search-form-container {
    max-width: 600px;
    margin: 20px auto;
}

.filter-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
}

.filter-card h3 {
    margin-bottom: 15px;
    color: #333;
}

.filter-card .form-group {
    margin-bottom: 15px;
}

.filter-card label {
    display: block;
    margin-bottom: 5px;
    color: #666;
}

.results-info {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
}

.results-info p {
    margin: 0;
    color: #666;
}

.post-tags {
    margin: 10px 0;
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}

.tag-badge {
    background: #667eea;
    color: white;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    text-decoration: none;
}

.tag-badge:hover {
    background: #5a67d8;
}
</style>
{% endblock %}